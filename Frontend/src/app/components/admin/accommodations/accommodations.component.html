<div class="accommodation-page">

  <h2 class="page-title">Szállások</h2>

  <div class="search-bar">
    <input 
      type="text" 
      placeholder="Szállások keresése..." 
      [(ngModel)]="searchText"
    >
    <button (click)="search()">Keresés</button>
  </div>
  <button class="add-btn mb-3" data-bs-toggle="modal" data-bs-target="#addAccommodationModal" *ngIf="IsAdmin">
    Új szállás hozzáadása
  </button>

  <div class="accommodation-grid">

    <div class="acc-card" *ngFor="let acc of accommodations">

      <img *ngIf="acc.imagePath" src="{{serverUrl}}{{acc.imagePath}}" alt="{{acc.name}}" class="thumbnail" (click)="openLightbox(acc.imagePath)">

      <div class="acc-content">
        <h3>{{ acc.name }}</h3>

        <p class="location">
          <i class="bi bi-geo-alt"></i>
          {{ acc.address }}
        </p>

        <p class="desc">
          {{ acc.description }}
        </p>

        <div class="price">
          From <strong>{{ acc.basePrice }} Ft / éjszaka</strong>
        </div>

        <div class="btn-row">
          <button class="btn edit-btn"  data-bs-toggle="modal" data-bs-target="#editAccommodationModal" *ngIf="IsAdmin"  (click)="editAccommodation(acc.id!)">Szerkesztés</button>
          <button class="btn delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal" *ngIf="IsAdmin" (click)="setDeleteId(acc.id!)">Törlés</button>
        </div>
      </div>

    </div>

  </div>

</div>


<!-- Add Accommodation Modal -->
<div class="modal fade" id="addAccommodationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content edit-modal">

      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Szállás hozzáadása</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form #editForm="ngForm">

          <div class="row g-3">
            <!-- Name -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="accName" placeholder="Name" [(ngModel)]="newAccommodation.name" name="name" required>
                <label for="accName">Név</label>
              </div>
            </div>

            <!-- Address -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="accAddress" placeholder="Address" [(ngModel)]="newAccommodation.address" name="address" required>
                <label for="accAddress">Cím</label>
              </div>
            </div>

            <!-- Description -->
            <div class="col-12">
              <div class="form-floating">
                <textarea class="form-control" id="accDescription" placeholder="Description" [(ngModel)]="newAccommodation.description" name="description" style="height:100px;" required></textarea>
                <label for="accDescription">Leírás</label>
              </div>
            </div>
            <!--File-->
            <div class="mb-3">
              <label for="formFile" class="form-label">Általános fájl bevitel</label>
              <input class="form-control" type="file" id="formFile"(change)="onAddFileSelected($event)">
            </div>
            <!-- Capacity -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="number" class="form-control" id="accCapacity" placeholder="Capacity" [(ngModel)]="newAccommodation.capacity" name="capacity" required>
                <label for="accCapacity">Kapacitás</label>
              </div>
            </div>

            <!-- Base Price -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="number" class="form-control" id="accPrice" placeholder="Base Price" [(ngModel)]="newAccommodation.basePrice" name="basePrice" required>
                <label for="accPrice">Alapár (Ft)</label>
              </div>
            </div>

          </div>

        </form>
      </div>

      <div class="modal-footer">
        <button class="btn cancel-btn" data-bs-dismiss="modal">Mégse</button>
        <button class="btn save-btn"  (click)="addNewAccommodation()" data-bs-dismiss="modal">Hozzáadás</button>
      </div>

    </div>
  </div>
</div>


<!-- Edit Accommodation Modal -->
<div class="modal fade" id="editAccommodationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content edit-modal">

      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Szállás szerkesztése</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form #editForm="ngForm">

          <div class="row g-3">
            <!-- Name -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="accName" placeholder="Name" [(ngModel)]="selectedAccommodation.name" name="name" required>
                <label for="accName">Név</label>
              </div>
            </div>

            <!-- Address -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="accAddress" placeholder="Address" [(ngModel)]="selectedAccommodation.address" name="address" required>
                <label for="accAddress">Cím</label>
              </div>
            </div>

            <!-- Description -->
            <div class="col-12">
              <div class="form-floating">
                <textarea class="form-control" id="accDescription" placeholder="Description" [(ngModel)]="selectedAccommodation.description" name="description" style="height:100px;" required></textarea>
                <label for="accDescription">Leírás</label>
              </div>
            </div>
            <!--File-->
            <div class="mb-3">
              <label for="formFile" class="form-label">Általános fájl bevitel</label>
              <input class="form-control" type="file" id="formFile"(change)="onEditFileSelected($event)">
            </div>
            <!-- Capacity -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="number" class="form-control" id="accCapacity" placeholder="Capacity" [(ngModel)]="selectedAccommodation.capacity" name="capacity" required>
                <label for="accCapacity">Kapacitás</label>
              </div>
            </div>

            <!-- Base Price -->
            <div class="col-md-6">
              <div class="form-floating">
                <input type="number" class="form-control" id="accPrice" placeholder="Base Price" [(ngModel)]="selectedAccommodation.basePrice" name="basePrice" required>
                <label for="accPrice">Alapár (Ft)</label>
              </div>
            </div>

            <!-- Active -->
            <div class="col-md-6">
              <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" id="accActive" [(ngModel)]="selectedAccommodation.active" name="active">
                <label class="form-check-label" for="accActive">Aktív</label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn cancel-btn" data-bs-dismiss="modal">Mégse</button>
        <button class="btn save-btn" (click)="confirmEdit()" data-bs-dismiss="modal">Változások mentése</button>
      </div>

    </div>
  </div>
</div>
<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content delete-modal">

      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle-fill"></i>
          Törlés megerősítése
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>
          Biztosan törölni szeretnéd ezt az elemet?
        </p>
        <p class="warning-text">
          Ez a művelet nem visszavonható.
        </p>
      </div>

      <div class="modal-footer">
        <button class="btn cancel-btn" data-bs-dismiss="modal">
          Mégse 
        </button>
        <button class="btn delete-btn" (click)="confirmDelete()" data-bs-dismiss="modal">
          Törlés
        </button>
      </div>

    </div>
  </div>
</div>
<app-lightbox
  [imageUrl]="lightboxImage"
  [visible]="lightboxVisible"
  (closed)="lightboxVisible = false">
</app-lightbox>
